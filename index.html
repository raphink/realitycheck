<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>RealityCheck</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    body {
      background-color: #f8f9fa;
    }
    .card {
      margin: 20px auto;
      max-width: 600px;
    }
    .post-image img {
      width: 100%;
      border-radius: 5px;
    }
    #responseContainer {
      max-width: 600px;
      margin: 20px auto;
    }
    /* TikTok overlay style */
    .overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0,0,0,0.5);
      padding: 10px;
    }
    /* True/False button container */
    #buttonContainer {
      max-width: 600px;
      margin: 10px auto;
      display: flex;
      justify-content: center;
      gap: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="text-center my-4">RealityCheck</h1>
    <div class="form-group">
      <select class="form-control" id="topicSelect">
        <option value="random" selected>Random</option>
        <option value="history">History</option>
        <option value="science">Science</option>
        <option value="politics">Politics</option>
      </select>
    </div>
    <!-- Post Card -->
    <div id="postContainer" class="card">
      <div class="card-body" id="postContent">
        <!-- Post content will be injected here -->
      </div>
    </div>
    <!-- True/False Buttons Container -->
    <div id="buttonContainer">
      <button class="btn btn-success" id="trueBtn">True</button>
      <button class="btn btn-danger" id="falseBtn">False</button>
    </div>
    <!-- Response Alert (for explanation and Next button) -->
    <div id="responseContainer" class="alert alert-info d-none"></div>
  </div>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <!-- Bootstrap JS -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script>
    var currentFact = null;
    var currentTopic = $('#topicSelect').val();

    // List of available topics (corresponds to JSON file names)
    var availableTopics = ["history", "science", "politics"];

    // Function to pick a topic if "random" is selected.
    function getSelectedTopic() {
      var topic = $('#topicSelect').val();
      if(topic === "random") {
        topic = availableTopics[Math.floor(Math.random() * availableTopics.length)];
      }
      return topic;
    }

    // Fetch a random user (username and profile picture) from Random User API.
    function getRandomUser() {
      return $.getJSON('https://randomuser.me/api/').then(function(data) {
        var user = data.results[0];
        var username = "@" + user.login.username;
        var profilePicUrl = user.picture.thumbnail;
        return { username: username, profilePicUrl: profilePicUrl };
      });
    }

    // Optionally include a random image from Picsum Photos (70% chance).
    function getRandomImageHtml(fact) {
      if (Math.random() < 0.7) {
        var imageUrl = "https://picsum.photos/500/300?random=" + Math.random();
        return '<div class="post-image my-3">' +
                 '<img src="' + imageUrl + '" alt="Random image">' +
               '</div>';
      }
      return '';
    }

    // ----- Social Media Style Renderers (buttons excluded) -----

    // Twitter-like style.
    function renderTwitterPost(fact, userData) {
      var likes = Math.floor(Math.random() * 10000);
      var retweets = Math.floor(Math.random() * 500);
      var timeStamp = Math.floor(Math.random() * 12) + "h";
      var imageHtml = getRandomImageHtml(fact);
      return '<div class="post-header d-flex align-items-center mb-2">' +
               '<img src="' + userData.profilePicUrl + '" alt="Profile Pic">' +
               '<div class="ml-2">' +
                 '<strong>' + userData.username + '</strong> ' +
                 '<span class="text-muted">@' + userData.username.slice(1) + '</span><br>' +
                 '<small class="text-muted">· ' + timeStamp + '</small>' +
               '</div>' +
             '</div>' +
             imageHtml +
             '<div class="post-content mb-3">' +
               '<p>' + fact.text + '</p>' +
             '</div>' +
             '<div class="post-footer">' +
               '<small>Likes: ' + likes + ' | Retweets: ' + retweets + '</small>' +
             '</div>';
    }

    // Bluesky-like style.
    function renderBlueskyPost(fact, userData) {
      var likes = Math.floor(Math.random() * 8000);
      var reposts = Math.floor(Math.random() * 400);
      var timeStamp = Math.floor(Math.random() * 12) + "h";
      var imageHtml = getRandomImageHtml(fact);
      return '<div class="post-header p-2" style="background:#e7f3ff; border-radius:5px;">' +
               '<img src="' + userData.profilePicUrl + '" alt="Profile Pic">' +
               '<span class="ml-2"><strong>' + userData.username + '</strong> ' +
               '<small class="text-muted">· ' + timeStamp + '</small></span>' +
             '</div>' +
             imageHtml +
             '<div class="post-content mt-3">' +
               '<p>' + fact.text + '</p>' +
             '</div>' +
             '<div class="post-footer mt-2">' +
               '<small>Likes: ' + likes + ' | Reposts: ' + reposts + '</small>' +
             '</div>';
    }

    // Instagram-like style.
    function renderInstagramPost(fact, userData) {
      var likes = Math.floor(Math.random() * 15000);
      var imageHtml = getRandomImageHtml(fact);
      if (!imageHtml) {
        imageHtml = '<div class="post-image my-3">' +
                      '<img src="https://via.placeholder.com/500" alt="Post Image">' +
                    '</div>';
      }
      return '<div class="post-header d-flex align-items-center mb-2">' +
               '<img src="' + userData.profilePicUrl + '" alt="Profile Pic">' +
               '<strong class="ml-2">' + userData.username + '</strong>' +
             '</div>' +
             imageHtml +
             '<div class="post-content mb-3">' +
               '<p>' + fact.text + '</p>' +
             '</div>' +
             '<div class="post-footer">' +
               '<small>Likes: ' + likes + '</small>' +
             '</div>';
    }

    // TikTok-like style.
    function renderTikTokPost(fact, userData) {
      var likes = Math.floor(Math.random() * 20000);
      var imageHtml = getRandomImageHtml(fact);
      if (!imageHtml) {
        imageHtml = '<div class="post-image my-3">' +
                      '<img src="https://via.placeholder.com/500x800" alt="Video Thumbnail">' +
                    '</div>';
      }
      return '<div class="position-relative text-white" style="border-radius:5px; overflow:hidden;">' +
               imageHtml +
               '<div class="overlay">' +
                 '<strong>' + userData.username + '</strong><br>' +
                 '<p class="mb-1">' + fact.text + '</p>' +
                 '<small>Likes: ' + likes + '</small>' +
               '</div>' +
             '</div>';
    }

    // Randomly select one of the styles.
    function renderPost(fact, userData) {
      var styles = ['twitter', 'bluesky', 'instagram', 'tiktok'];
      var selectedStyle = styles[Math.floor(Math.random() * styles.length)];
      switch(selectedStyle) {
        case 'twitter':
          return renderTwitterPost(fact, userData);
        case 'bluesky':
          return renderBlueskyPost(fact, userData);
        case 'instagram':
          return renderInstagramPost(fact, userData);
        case 'tiktok':
          return renderTikTokPost(fact, userData);
        default:
          return renderTwitterPost(fact, userData);
      }
    }

    // Load a random fact from the chosen topic JSON and render the post.
    function loadTopic() {
      var topic = getSelectedTopic();
      $.getJSON(topic + '.json', function(data) {
        var randomFact = data[Math.floor(Math.random() * data.length)];
        currentFact = randomFact;
        getRandomUser().then(function(userData) {
          $('#postContent').html(renderPost(randomFact, userData));
          // Clear any previous explanation.
          $('#responseContainer').addClass('d-none').html('');
        });
      }).fail(function() {
        $('#postContent').html('<p class="text-danger">Failed to load data for ' + topic + '.</p>');
      });
    }

    $(document).ready(function(){
      loadTopic();

      $('#topicSelect').change(function(){
        loadTopic();
      });

      // Handle True/False answer clicks.
      $('#buttonContainer').on('click', '#trueBtn, #falseBtn', function(){
        // Prevent multiple submissions.
        if(!$('#responseContainer').hasClass('d-none')) return;
        var selectedAnswer = $(this).attr('id') === 'trueBtn';
        var explanationHTML = '';
        if(selectedAnswer === currentFact.answer) {
          explanationHTML = '<strong>Correct!</strong> ' + currentFact.explanation;
        } else {
          explanationHTML = '<strong>Incorrect.</strong> ' + currentFact.explanation;
        }
        explanationHTML += '<br><br><div class="text-center"><button class="btn btn-primary" id="nextBtn">Next</button></div>';
        $('#responseContainer').removeClass('d-none').html(explanationHTML);
      });

      // Handle Next button.
      $('#responseContainer').on('click', '#nextBtn', function(){
        loadTopic();
      });
    });
  </script>
</body>
</html>
